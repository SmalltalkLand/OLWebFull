{"ast":null,"code":"import _Object$assign from \"@babel/runtime-corejs2/core-js/object/assign\";\nimport _Map from \"@babel/runtime-corejs2/core-js/map\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport * as R from 'ramda';\nexport default (function (React) {\n  return function (mode) {\n    return function (desktop, lib, addWindow) {\n      return function (appCode) {\n        var w = new Worker(URL.createObjectURL(new Blob(appCode)));\n        var morohClassMap = new _Map();\n\n        var newMoroh = function newMoroh(desc) {\n          return R.pipe([R.props(['desc', 'children']), function (ndesc) {\n            return [ndesc[0] ? _Object$assign({}, desc, ndesc[0]) : desc, ndesk[1]];\n          }, function (desc) {\n            return __jsx(lib.Div, {\n              onClick: w.postMessage.bind(w, desc[0].clickMessage),\n              style: {\n                bg: desc[0].color,\n                \"backgroundColor\": desc[0].color\n              }\n            }, desk[1].concat(desc[0].children.map(function (c) {\n              return function (MC) {\n                return __jsx(MC, null);\n              }(newMoroh(c));\n            })));\n          }]);\n        };\n\n        w.addEventListener('message', R.pipe([function (m) {\n          return m.data;\n        }, R.cond([[function (d) {\n          return d.type === 'post_canvas';\n        }, R.pipe([function (d) {\n          return d.data;\n        }, function (d) {\n          return [d, document.createElement('canvas')];\n        }, function (d) {\n          return {\n            canvas: d[1],\n            d: d[0],\n            id: d[0].name,\n            render: R.pipe([function (rct) {\n              return [rct, d[1]];\n            }, function (a) {\n              return __jsx(lib.Div, {\n                ref: R.pipe([function (e) {\n                  return e.appendChild.bind(e);\n                }, R.partialRight(R.call, a[1])])\n              });\n            }])\n          };\n        }, R.tap(addWindow), R.props('canvas', 'd'), function (c) {\n          return [c[0].transferControlToOffscreen(), c[1]];\n        }, function (nc) {\n          return [{\n            type: 'return',\n            data: {\n              id: nc[1].id,\n              canvas: nc[0]\n            }\n          }, nc[0]];\n        }, R.apply.bind(R, w.postMessage.bind(w))])], [function (d) {\n          return d.type === 'create_moroh';\n        }, R.pipe([function (d) {\n          return d.data;\n        }, function (d) {\n          return [d[0], newMoroh(d[1])];\n        }, R.tap(R.apply.bind(R, morohClassMap.set.bind(morohClassMap)))])], [function (d) {\n          return d.type === 'moroh_in_window';\n        }, R.pipe([function (d) {\n          return d.data;\n        }, R.props('id', 'wid'), function (d) {\n          return [morohClassMap.get(d[0]), d[1]];\n        }, function (d) {\n          return [{\n            id: d[1],\n            render: function render(rct) {\n              return function (C) {\n                return __jsx(C, null);\n              }(d[0]);\n            }\n          }];\n        }, R.tap(addWindow)])]])]));\n      };\n    };\n  };\n});","map":{"version":3,"sources":["D:/Graham/ObjectLand/main/OLWebFull/src/appi.js"],"names":["R","React","mode","desktop","lib","addWindow","appCode","w","Worker","URL","createObjectURL","Blob","morohClassMap","newMoroh","desc","pipe","props","ndesc","ndesk","postMessage","bind","clickMessage","bg","color","desk","concat","children","map","c","MC","addEventListener","m","data","cond","d","type","document","createElement","canvas","id","name","render","rct","a","e","appendChild","partialRight","call","tap","transferControlToOffscreen","nc","apply","set","get","C"],"mappings":"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","sourcesContent":["import * as R from 'ramda'\r\nexport default React => mode => (desktop,lib,addWindow) => appCode => {\r\n    let w = new Worker(URL.createObjectURL(new Blob(appCode)));\r\n    let morohClassMap = new Map();\r\n    let newMoroh = (desc => R.pipe([R.props(['desc','children']),ndesc => [ndesc[0] ? Object.assign({},desc,ndesc[0]) : desc,ndesk[1]],desc => (<lib.Div onClick = {w.postMessage.bind(w,desc[0].clickMessage)} style = {{bg: desc[0].color,\"backgroundColor\": desc[0].color}}>{desk[1].concat(desc[0].children.map(c => (MC => (<MC></MC>))(newMoroh(c))))}</lib.Div>)]))\r\n    w.addEventListener('message',R.pipe([m => m.data,R.cond([\r\n    [d => d.type === 'post_canvas',\r\n    R.pipe([d => d.data,\r\n        d => ([d,document.createElement('canvas')]),\r\n        d => ({canvas: d[1],d: d[0],id: d[0].name,render: R.pipe([rct => ([rct,d[1]]),a => (<lib.Div ref = {R.pipe([e => e.appendChild.bind(e),R.partialRight(R.call,a[1])])}></lib.Div>)])}),\r\n        R.tap(addWindow),\r\n        R.props('canvas','d'),\r\n        c => [c[0].transferControlToOffscreen(),c[1]],\r\n        nc => [{type: 'return',data:{id: nc[1].id,canvas: nc[0]}},nc[0]],\r\n        R.apply.bind(R,w.postMessage.bind(w)),\r\n    ])\r\n    ],\r\n    [\r\nd => d.type === 'create_moroh',\r\nR.pipe([\r\nd => d.data,\r\nd => [d[0],newMoroh(d[1])],\r\nR.tap(R.apply.bind(R,morohClassMap.set.bind(morohClassMap))),\r\n\r\n\r\n])\r\n\r\n    ],\r\n    [\r\nd => d.type === 'moroh_in_window',\r\nR.pipe([\r\nd => d.data,\r\nR.props('id','wid'),\r\nd => [morohClassMap.get(d[0]),d[1]],\r\nd => [{id: d[1],render: rct => (C => (<C></C>))(d[0])}],\r\nR.tap(addWindow),\r\n])\r\n\r\n    ]\r\n\r\n])]));\r\n}"]},"metadata":{},"sourceType":"module"}