{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _Map from \"@babel/runtime-corejs2/core-js/map\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _Object$assign from \"@babel/runtime-corejs2/core-js/object/assign\";\nvar __jsx = React.createElement;\nimport React, { useState } from 'react';\nimport * as ReactZ from 'react';\nimport { Tabs, Tab } from 'react-bootstrap';\nimport root from 'react-shadow';\nimport Window_ from '../../src/Window.js';\nimport Iframe_ from '../../src/Iframe.js';\nimport MainWelcomePage from '../index.js';\nimport Desktop3D from '../3desktop/index.js';\nimport DiscordPolyfill from '../../src/DiscordPolyfill.js';\nimport Discord from '../discord/index.js';\nimport AAPI from '../../src/appi.js';\nimport * as R from 'ramda';\nimport * as Polyglot from 'node-polyglot';\nimport { create } from \"react-test-renderer\";\nimport MainWorker from '../../src/main.worker.js';\nimport BrowserWrapper from '../../src/browser_loader.js';\nimport Prezi from '../prezi.js';\nimport cw from '../../src/cw.js';\nimport useEventListener from '../../src/handler.js';\nimport Inspector_ from '../../src/Inspector.js';\n\nclass ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      hasError: false\n    };\n  }\n\n  static getDerivedStateFromError(error) {\n    return {\n      hasError: true\n    };\n  }\n\n  componentDidCatch(error, errorInfo) {}\n\n  render() {\n    if (this.state.hasError) {\n      return __jsx(\"h1\", null, \"Something went wrong.\");\n    }\n\n    return this.props.children;\n  }\n\n}\n\nlet Inspector = R.pipe(props => _Object$assign({}, props, props.lib), Inspector_);\n\nlet DefaultDOMCanvas = props => __jsx(\"canvas\", _extends({}, props, {\n  ref: props.onCanvas\n}));\n\nlet List = props => __jsx(\"div\", null, props.all.map(v => __jsx(\"div\", {\n  className: props.selected === v ? 'selected' : '',\n  onClick: props.onSelect.bind(null, v),\n  key: v\n})));\n\nlet ExtensionLib;\nimport('../../ol-ex/lib.js').then(v => ExtensionLib = v).catch(err => {});\nexport default class Desktop extends React.Component {\n  get document() {\n    try {\n      return document;\n    } catch (err) {\n      return null;\n    }\n  }\n\n  constructor(props = {}) {\n    super(props);\n    this.state = {\n      usesSingleWindow: false,\n      currentWindow: undefined,\n      objectTagSheet: {},\n      HotTable: null,\n      appDataMap: new _Map(),\n      windows: [],\n      d_a: undefined,\n      javaPackage: undefined,\n      jlink: undefined,\n      ex: undefined\n    };\n    this.state = _Object$assign({}, this.state, (() => {\n      try {\n        return {\n          javaPackage: Packages.com.smalltalkland.slandroid,\n          jlink: jlink\n        };\n      } catch (err) {\n        return {};\n      }\n    })());\n    this.aapi_ = React && AAPI(React)(props.mode);\n\n    this.aapi = code => this.aapi_(this, this.addWindow.bind(this))(code);\n\n    this.renderExWinPossibly = () => __jsx(\"span\", null);\n\n    var f;\n\n    try {\n      f = fetch;\n    } catch (err) {\n      f = () => _Promise.reject();\n    }\n\n    ;\n    f('/pages/api/usr').then(r => r.text()).then(t => {}).catch(err => {});\n\n    try {\n      if (navigator) import('@handsontable/react').then(m => this.mounted && this.setState({\n        HotTable: m.HotTable\n      }));\n    } catch (err) {}\n\n    ;\n    import('react-mutation-observer').then(m => this.setState({\n      d_a: m\n    })).catch(err => {});\n  }\n\n  componentDidUpdate(prevProps) {\n    // Typical usage (don't forget to compare props):\n    if (prevProps.mode !== this.props.mode) this.aapi_ = AAPI(React)(this.props.mode);\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  addWindow(w) {\n    return new _Promise(c => this.setState(s => ({\n      windows: s.windows.concat([w])\n    }), c));\n  }\n\n  removeWindow(w) {\n    return new _Promise(c => this.setState(s => ({\n      windows: s.windows.filter(sw => sw.id !== w.id)\n    })));\n  }\n\n  renderExWin(Div, Window) {\n    return __jsx(Window, null, __jsx(Div, null));\n  }\n\n  get discord() {\n    return this.props.discord || DiscordPolyfill(this);\n  }\n\n  render() {\n    let document = this.document;\n    let wrap = R.identity;\n    let HotTable;\n\n    try {\n      if (navigator) HotTable = this.state.HotTable;\n    } catch (err) {\n      HotTable = function (props) {\n        return __jsx(\"span\", null);\n      };\n    }\n\n    ;\n    let isBrowser = false;\n\n    try {\n      navigator;\n      isBrowser = true;\n    } catch (err) {}\n\n    ;\n    let discord = this.discord;\n    let Div = this.props.div || root.div;\n    let Window = this.props.Window || Window_;\n    let Iframe = this.props.Iframe || Iframe_;\n    let DOMCanvas = this.props.Canvas || DefaultDOMCanvas;\n\n    let MyMutationObserver = this.props.Observer || this.state.d_a && this.state.d_a.MutationObserver || (props => props.children);\n\n    if (!document) MyMutationObserver = props => props.children;\n\n    MyMutationObserver = MyMutationObserver || (props => props.children);\n\n    let lib = {\n      List,\n      div: Div,\n      Div,\n      Window,\n      Iframe,\n      MutationObserver: MyMutationObserver,\n      useEventListener,\n      DOMInterop: {\n        DOMCanvas\n      },\n      cw,\n      desk: {\n        getDeskProps: () => this.props\n      },\n      TextArea: isBrowser || document ? 'textarea' : null,\n      Tabs: isBrowser || document ? {\n        Tabs,\n        Tab\n      } : null\n    };\n    let windows = (this.props.windows || []).concat(this.props.div === null ? [{\n      id: 'welcome',\n      render: React => {\n        return __jsx(MainWelcomePage, null);\n      }\n    }] : []).concat(discord ? [{\n      id: 'discord',\n      render: (React, lib) => {\n        let theDiscord = Discord(React, useState);\n        return __jsx(lib.Div, null, __jsx(\"theDiscord\", {\n          lib: lib,\n          discord: discord\n        }));\n      }\n    }] : []).concat(isBrowser && Desktop3D ? [{\n      id: 'three',\n      render: rct => __jsx(ErrorBoundary, null, __jsx(Desktop3D, {\n        dcls: Desktop,\n        linkParent: this\n      }))\n    }] : []) //.concat(isBrowser ? [{id: 'prezi',render: rct => Prezi.w(<div><Prezi noDesktop = {true}></Prezi></div>)}] : [])\n    .concat(Iframe.canRenderHTML && ExtensionLib ? [{\n      id: 'langs',\n      render: r => __jsx(Iframe.html, {\n        src: (() => {\n          try {\n            return location.hostname + '/lang/' + lang;\n          } catch (err) {\n            return '';\n          }\n        })(),\n        windowRef: win => {\n          ExtensionLib.dr(win.document.querySelector('#firstHeading'));\n        }\n      })\n    }] : []).concat(this.constructor.wins.map(w => w(this, lib))).concat([]).concat(this.state.windows).concat([{\n      id: 'self',\n      render: (React, lib) => __jsx(Inspector, {\n        lib: lib,\n        obj: this\n      })\n    }]);\n\n    let rw = w => __jsx(MyMutationObserver, {\n      key: w.id\n    }, __jsx(Window, null, __jsx(MyMutationObserver, null, w.render(_Object$assign({}, React, ReactZ), lib, this.state.appDataMap.get(w.id), v => {\n      this.setState({\n        appDataMap: new _Map(this.state.appDataMap).set(w.id, v)\n      });\n    }))));\n\n    if (this.props.w) wrap = R.pipe(wrap, this.props.w.bind(null, lib));\n    if (this.state.usesSingleWindow) wrap = R.pipe(wrap, e => __jsx(MyMutationObserver, null, __jsx(Div, null, this.state.currentWindow ? rw(this.state.currentWindow) : this.props.children)));\n    if (this.props.isWatch) wrap = R.pipe(wrap, e => __jsx(MyMutationObserver, null, __jsx(Div, null, __jsx(this.props.Watch, null, __jsx(MyMutationObserver, null, e.props.children[0].props.children[0].props.children)))));\n    if (this.props.head === 'less') wrap = R.pipe(wrap, create);\n    if (this.props.head === 'embed') wrap = R.pipe(wrap, e => {\n      e.props.children[0].props.children.map(c => c.key === 'sutils' ? c.props.children[0].props.children[0].props.children[0].children.map(nc => ReactDOM.render(nc, (e => {\n        var _document$querySelect;\n\n        e.classList.add('ol');\n        let existing = document.querySelector('.sprite-info_group_14-B_').querySelector('.ol');\n        if (existing) return existing;\n        (_document$querySelect = document.querySelector('.sprite-info_group_14-B_')) === null || _document$querySelect === void 0 ? void 0 : _document$querySelect.appendChild(e);\n        return e;\n      })(document.createElement('div')))) : null);\n    });\n    if (this.props.connextToEx) wrap = R.pipe(wrap, e => this.props.ex ? (() => {\n      this.setState((s, p) => ({\n        ex: p.ex\n      }));\n      return e;\n    })() : __jsx(BrowserWrapper, null, v => {\n      this.setState({\n        ex: v\n      });\n      return e;\n    }));\n    return wrap(__jsx(MyMutationObserver, null, __jsx(Div, null, this.props.children, __jsx(Window, null, HotTable && __jsx(HotTable, null)), this.renderExWinPossibly(Div, Window), windows.map(rw))));\n  }\n\n}\n\n_Object$assign(Desktop, {\n  wins: []\n});","map":{"version":3,"sources":["/home/graham/st/OLWebFull/pages/desktop/index.js"],"names":["React","useState","ReactZ","Tabs","Tab","root","Window_","Iframe_","MainWelcomePage","Desktop3D","DiscordPolyfill","Discord","AAPI","R","Polyglot","create","MainWorker","BrowserWrapper","Prezi","cw","useEventListener","Inspector_","ErrorBoundary","Component","constructor","props","state","hasError","getDerivedStateFromError","error","componentDidCatch","errorInfo","render","children","Inspector","pipe","lib","DefaultDOMCanvas","onCanvas","List","all","map","v","selected","onSelect","bind","ExtensionLib","then","catch","err","Desktop","document","usesSingleWindow","currentWindow","undefined","objectTagSheet","HotTable","appDataMap","windows","d_a","javaPackage","jlink","ex","Packages","com","smalltalkland","slandroid","aapi_","mode","aapi","code","addWindow","renderExWinPossibly","f","fetch","reject","r","text","t","navigator","m","mounted","setState","componentDidUpdate","prevProps","componentDidMount","componentWillUnmount","w","c","s","concat","removeWindow","filter","sw","id","renderExWin","Div","Window","discord","wrap","identity","isBrowser","div","Iframe","DOMCanvas","Canvas","MyMutationObserver","Observer","MutationObserver","DOMInterop","desk","getDeskProps","TextArea","theDiscord","rct","canRenderHTML","location","hostname","lang","win","dr","querySelector","wins","rw","get","set","e","isWatch","head","key","nc","ReactDOM","classList","add","existing","appendChild","createElement","connextToEx","p"],"mappings":"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","sourcesContent":["import React, {useState} from 'react'\nimport * as ReactZ from 'react'\nimport {Tabs, Tab} from 'react-bootstrap'\nimport root from 'react-shadow';\nimport Window_ from '../../src/Window.js'\nimport Iframe_ from '../../src/Iframe.js'\nimport MainWelcomePage from '../index.js';\nimport Desktop3D from '../3desktop/index.js'\nimport DiscordPolyfill from '../../src/DiscordPolyfill.js'\nimport Discord from '../discord/index.js'\nimport AAPI from '../../src/appi.js'\nimport * as R from 'ramda'\nimport * as Polyglot from 'node-polyglot'\nimport { create } from \"react-test-renderer\";\nimport MainWorker from '../../src/main.worker.js'\nimport BrowserWrapper from '../../src/browser_loader.js'\nimport Prezi from '../prezi.js'\nimport cw from '../../src/cw.js'\nimport useEventListener from '../../src/handler.js'\nimport Inspector_ from '../../src/Inspector.js'\nclass ErrorBoundary extends React.Component {\n    constructor(props) {\n      super(props);\n      this.state = { hasError: false };\n    }\n  \n    static getDerivedStateFromError(error) {    return { hasError: true };  }\n    componentDidCatch(error, errorInfo) {     }\n    render() {\n      if (this.state.hasError) {      return <h1>Something went wrong.</h1>;    }\n      return this.props.children; \n    }\n  }\nlet Inspector = R.pipe(props => Object.assign({},props,props.lib),Inspector_);\nlet DefaultDOMCanvas = props => (<canvas {...props} ref = {props.onCanvas}></canvas>)\nlet List = props => (<div>{props.all.map(v => (<div className = {props.selected === v ? 'selected' : ''} onClick = {props.onSelect.bind(null,v)} key = {v}></div>))}</div>)\nlet ExtensionLib;\nimport('../../ol-ex/lib.js').then(v => ExtensionLib = v).catch(err => {});\nexport default class Desktop extends React.Component{\n    get document(){try{return document}catch(err){return null}}\n    constructor(props = {}){\nsuper(props);\nthis.state = {usesSingleWindow: false,currentWindow: undefined,objectTagSheet: {},HotTable: null,appDataMap: new Map(),windows: [],d_a: undefined,javaPackage: undefined,jlink: undefined,ex: undefined};\nthis.state = Object.assign({},this.state,(() => {try{return {javaPackage: Packages.com.smalltalkland.slandroid,jlink: jlink}}catch(err){return {}}})());\nthis.aapi_ = React && AAPI(React)(props.mode);\nthis.aapi = code => this.aapi_(this,this.addWindow.bind(this))(code);\n    this.renderExWinPossibly = () => (<span></span>);\nvar f;\ntry{\nf = fetch;\n}catch(err){\nf = () => Promise.reject();\n\n};\n(f)('/pages/api/usr').then(r => r.text()).then(t => {\n\n\n}).catch(err => {});\ntry{\nif(navigator)import('@handsontable/react').then(m => this.mounted && this.setState({HotTable: m.HotTable}));\n}catch(err){\n\n\n}; \nimport('react-mutation-observer').then(m => this.setState({d_a: m})).catch(err => {});\n}\ncomponentDidUpdate(prevProps) {\n    // Typical usage (don't forget to compare props):\nif(prevProps.mode !== this.props.mode)this.aapi_ = AAPI(React)(this.props.mode)\n  }\ncomponentDidMount(){\n    this.mounted = true;\n    \n    }\n    componentWillUnmount(){\nthis.mounted = false;\n\n    }\n    addWindow(w){\n        return new Promise(c => this.setState(s => ({windows: s.windows.concat([w])}),c))\n    }\n    removeWindow(w){\nreturn new Promise(c => this.setState(s => ({windows: s.windows.filter(sw => sw.id !== w.id)})))\n\n    }\n    renderExWin(Div,Window){\nreturn (<Window><Div></Div></Window>)\n\n    }\n    get discord(){return this.props.discord || (DiscordPolyfill(this))}\nrender(){\n    let document = this.document;\n    let wrap = R.identity;\n    let HotTable;\n    try{\n    if(navigator)HotTable = this.state.HotTable;\n    }catch(err){\nHotTable = function(props){return (<span></span>)};\n\n    };\n    let isBrowser = false;\n    try{\n(navigator);\nisBrowser = true;\n\n    }catch(err){\n\n\n    };\n    let discord = this.discord;\n    let Div = this.props.div || root.div;\n    let Window = this.props.Window || Window_;\n    let Iframe = this.props.Iframe || Iframe_;\n    let DOMCanvas = this.props.Canvas || DefaultDOMCanvas;\n    let MyMutationObserver = this.props.Observer || (this.state.d_a && this.state.d_a.MutationObserver) || (props => props.children);\n    if(!document)MyMutationObserver = props => props.children;\n    MyMutationObserver = MyMutationObserver || (props => props.children);\n    let lib = {List,div: Div,Div,Window,Iframe,MutationObserver: MyMutationObserver,useEventListener,DOMInterop: {DOMCanvas},cw,desk: {getDeskProps: () => this.props},TextArea: isBrowser || document ? 'textarea': null,Tabs: isBrowser || document ? {Tabs, Tab} : null};\n    let windows = (this.props.windows || [])\n    .concat(this.props.div === null ? [{id: 'welcome',render: (React) => {return (<MainWelcomePage></MainWelcomePage>)}}] : [])\n    .concat(discord ? [{id: 'discord',render: (React,lib) => {let theDiscord = Discord(React,useState);return (<lib.Div><theDiscord lib = {lib} discord = {discord}></theDiscord></lib.Div>)}}] : [])\n    .concat(isBrowser  && Desktop3D ? [{id: 'three',render: rct => (<ErrorBoundary><Desktop3D dcls = {Desktop} linkParent = {this}></Desktop3D></ErrorBoundary>)}] : [])\n    //.concat(isBrowser ? [{id: 'prezi',render: rct => Prezi.w(<div><Prezi noDesktop = {true}></Prezi></div>)}] : [])\n    .concat(Iframe.canRenderHTML && ExtensionLib ? [{id: 'langs',render: r => (<Iframe.html src = {(() => {try{return location.hostname + '/lang/' + lang}catch(err){return ''}})()} windowRef = {win => {ExtensionLib.dr(win.document.querySelector('#firstHeading'))}}></Iframe.html>)}] : [])\n    .concat(this.constructor.wins.map(w => w(this,lib)))\n    .concat([])\n    .concat(this.state.windows)\n    .concat([{id: 'self',render: (React,lib) => (<Inspector lib = {lib} obj = {this}></Inspector>)}])\n    let rw = w => (<MyMutationObserver key = {w.id}><Window><MyMutationObserver>{w.render(Object.assign({},React,ReactZ),lib,this.state.appDataMap.get(w.id),(v) => {this.setState({appDataMap: new Map(this.state.appDataMap).set(w.id,v)})})}</MyMutationObserver></Window></MyMutationObserver>);\n    if(this.props.w)wrap = R.pipe(wrap,this.props.w.bind(null,lib));\n    if(this.state.usesSingleWindow)wrap = R.pipe(wrap,e => (<MyMutationObserver><Div>{this.state.currentWindow ? rw(this.state.currentWindow) : this.props.children}</Div></MyMutationObserver>));\nif(this.props.isWatch)wrap = R.pipe(wrap,e => (<MyMutationObserver><Div><this.props.Watch><MyMutationObserver>{e.props.children[0].props.children[0].props.children}</MyMutationObserver></this.props.Watch></Div></MyMutationObserver>));\n    if(this.props.head === 'less')wrap = R.pipe(wrap,create);\n    if(this.props.head === 'embed')wrap = R.pipe(wrap,e => {e.props.children[0].props.children.map(c => c.key === 'sutils' ? c.props.children[0].props.children[0].props.children[0].children.map(nc => ReactDOM.render(nc,(e => {e.classList.add('ol');let existing = document.querySelector('.sprite-info_group_14-B_').querySelector('.ol');if(existing)return existing;document.querySelector('.sprite-info_group_14-B_')?.appendChild(e); return e})(document.createElement('div')))) : null)});\nif(this.props.connextToEx)wrap = R.pipe(wrap,e => this.props.ex ? (() => {this.setState((s,p) => ({ex: p.ex})); return e})() : (<BrowserWrapper>{v => {this.setState({ex: v});return e}}</BrowserWrapper>));\n    return wrap(<MyMutationObserver><Div>\n    {this.props.children}\n<Window>{HotTable && <HotTable></HotTable>}</Window>\n    {this.renderExWinPossibly(Div,Window)}\n\n    {windows.map(rw)}\n    </Div></MyMutationObserver>)\n}\n}\nObject.assign(Desktop,{wins: []})"]},"metadata":{},"sourceType":"module"}