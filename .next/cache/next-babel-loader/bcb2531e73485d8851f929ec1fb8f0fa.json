{"ast":null,"code":"import _Object$assign from \"@babel/runtime-corejs2/core-js/object/assign\";\nimport _Map from \"@babel/runtime-corejs2/core-js/map\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport * as R from 'ramda';\nexport default (React => mode => (desktop, lib, addWindow) => appCode => {\n  let w = new Worker(URL.createObjectURL(new Blob(appCode)));\n  let morohClassMap = new _Map();\n\n  let newMoroh = desc => R.pipe([R.props(['desc', 'children']), ndesc => [ndesc[0] ? _Object$assign({}, desc, ndesc[0]) : desc, ndesk[1]], desc => __jsx(lib.Div, {\n    onClick: w.postMessage.bind(w, desc[0].clickMessage),\n    style: {\n      bg: desc[0].color,\n      \"backgroundColor\": desc[0].color\n    }\n  }, desk[1].concat(desc[0].children.map(c => (MC => __jsx(MC, null))(newMoroh(c)))))]);\n\n  w.addEventListener('message', R.pipe([m => m.data, R.cond([[d => d.type === 'post_canvas', R.pipe([d => d.data, d => [d, document.createElement('canvas')], d => ({\n    canvas: d[1],\n    d: d[0],\n    id: d[0].name,\n    render: R.pipe([rct => [rct, d[1]], a => __jsx(lib.Div, {\n      ref: R.pipe([e => e.appendChild.bind(e), R.partialRight(R.call, a[1])])\n    })])\n  }), R.tap(addWindow), R.props('canvas', 'd'), c => [c[0].transferControlToOffscreen(), c[1]], nc => [{\n    type: 'return',\n    data: {\n      id: nc[1].id,\n      canvas: nc[0]\n    }\n  }, nc[0]], R.apply.bind(R, w.postMessage.bind(w))])], [d => d.type === 'create_moroh', R.pipe([d => d.data, d => [d[0], newMoroh(d[1])], R.tap(R.apply.bind(R, morohClassMap.set.bind(morohClassMap)))])], [d => d.type === 'moroh_in_window', R.pipe([d => d.data, R.props('id', 'wid'), d => [morohClassMap.get(d[0]), d[1]], d => [{\n    id: d[1],\n    render: rct => (C => __jsx(C, null))(d[0])\n  }], R.tap(addWindow)])]])]));\n});","map":{"version":3,"sources":["D:/Graham/ObjectLand/main/OLWebFull/src/appi.js"],"names":["R","React","mode","desktop","lib","addWindow","appCode","w","Worker","URL","createObjectURL","Blob","morohClassMap","newMoroh","desc","pipe","props","ndesc","ndesk","postMessage","bind","clickMessage","bg","color","desk","concat","children","map","c","MC","addEventListener","m","data","cond","d","type","document","createElement","canvas","id","name","render","rct","a","e","appendChild","partialRight","call","tap","transferControlToOffscreen","nc","apply","set","get","C"],"mappings":"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","sourcesContent":["import * as R from 'ramda'\r\nexport default React => mode => (desktop,lib,addWindow) => appCode => {\r\n    let w = new Worker(URL.createObjectURL(new Blob(appCode)));\r\n    let morohClassMap = new Map();\r\n    let newMoroh = (desc => R.pipe([R.props(['desc','children']),ndesc => [ndesc[0] ? Object.assign({},desc,ndesc[0]) : desc,ndesk[1]],desc => (<lib.Div onClick = {w.postMessage.bind(w,desc[0].clickMessage)} style = {{bg: desc[0].color,\"backgroundColor\": desc[0].color}}>{desk[1].concat(desc[0].children.map(c => (MC => (<MC></MC>))(newMoroh(c))))}</lib.Div>)]))\r\n    w.addEventListener('message',R.pipe([m => m.data,R.cond([\r\n    [d => d.type === 'post_canvas',\r\n    R.pipe([d => d.data,\r\n        d => ([d,document.createElement('canvas')]),\r\n        d => ({canvas: d[1],d: d[0],id: d[0].name,render: R.pipe([rct => ([rct,d[1]]),a => (<lib.Div ref = {R.pipe([e => e.appendChild.bind(e),R.partialRight(R.call,a[1])])}></lib.Div>)])}),\r\n        R.tap(addWindow),\r\n        R.props('canvas','d'),\r\n        c => [c[0].transferControlToOffscreen(),c[1]],\r\n        nc => [{type: 'return',data:{id: nc[1].id,canvas: nc[0]}},nc[0]],\r\n        R.apply.bind(R,w.postMessage.bind(w)),\r\n    ])\r\n    ],\r\n    [\r\nd => d.type === 'create_moroh',\r\nR.pipe([\r\nd => d.data,\r\nd => [d[0],newMoroh(d[1])],\r\nR.tap(R.apply.bind(R,morohClassMap.set.bind(morohClassMap))),\r\n\r\n\r\n])\r\n\r\n    ],\r\n    [\r\nd => d.type === 'moroh_in_window',\r\nR.pipe([\r\nd => d.data,\r\nR.props('id','wid'),\r\nd => [morohClassMap.get(d[0]),d[1]],\r\nd => [{id: d[1],render: rct => (C => (<C></C>))(d[0])}],\r\nR.tap(addWindow),\r\n])\r\n\r\n    ]\r\n\r\n])]));\r\n}"]},"metadata":{},"sourceType":"module"}